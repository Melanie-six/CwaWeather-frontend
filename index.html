<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Candy Weather</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;900&family=Varela+Round&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ç³–æœæ¢ç´‹è‰² */
            --stripe-1: #FFCF40; 
            --stripe-2: #FFBF00;
            
            /* æ ¸å¿ƒç²‰ç´…å¡ç‰‡ */
            --popup-bg: linear-gradient(180deg, #FFF0F5 0%, #FFDEE9 100%);
            
            /* æ–‡å­—é¡è‰² */
            --header-blue: #0099CC;
            --temp-color: #ffffff; /* æº«åº¦ç´”ç™½ */
            --desc-color: rgba(93, 64, 55, 0.6); /* èªªæ˜æ–‡å­—(æ·±è‰²åŠé€æ˜) */
            
            /* é“å…·çƒé¡è‰² */
            --circle-blue-1: #f185f5;
            --circle-blue-2: #FF9BB3;
            
            /* åº•éƒ¨é å ±æ¢ (åŸæœ¬çš„è®Šæ•¸ä¿ç•™ï¼Œä½†ä¸‹é¢æœƒç”¨ RGBA è¦†è“‹) */
            --streak-bg: #001F4D;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Varela Round', sans-serif;
            
            /* === èƒŒæ™¯è¨­å®š === */
            background-image: url('body-bg.png'); /* è«‹ç¢ºèªåœ–ç‰‡è·¯å¾‘æ­£ç¢º */
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;

            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            padding: 20px;
        }

        /* === 1. é»ƒè‰²æ¢ç´‹å¤–æ¡† (ä¸»å¡ç‰‡) === */
        .candy-card-wrapper {
            width: 100%;
            max-width: 380px;
            padding: 12px;
            border-radius: 35px;
            background: repeating-linear-gradient(
                45deg,
                var(--stripe-1),
                var(--stripe-1) 15px,
                var(--stripe-2) 15px,
                var(--stripe-2) 30px
            );
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
            position: relative;
            z-index: 10;
            margin-bottom: 25px; /* èˆ‡ä¸‹æ–¹é å ±æ¢çš„è·é›¢ */
        }

        /* === 2. ç²‰ç´…å…§å±¤ === */
        .candy-inner {
            background: var(--popup-bg);
            border-radius: 25px;
            /* å¢åŠ ä¸‹æ–¹ padding çµ¦é“å…·çƒç©ºé–“ */
            padding: 50px 20px 25px 20px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: inset 0 0 15px rgba(255,255,255,0.9);
            border: 3px solid rgba(255,255,255,0.7);
            position: relative;
        }
/* === å³ä¸Šè§’æ—¥æœŸ (Candy Crush é—œé–‰æŒ‰éˆ•é¢¨æ ¼) === */
.date-badge {
    position: absolute;
    /* å®šä½åœ¨å³ä¸Šè§’ï¼Œä¸¦ç¨å¾®çªå‡ºå»ä¸€é» */
    top: -12px;
    right: -10px;
    z-index: 30; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */

    /* ç´…è‰²ç³–æœè³ªæ„Ÿ */
    background: linear-gradient(180deg, #FF6B6B 0%, #D32F2F 100%);
    
    /* ç™½è‰²ç²—é‚Šæ¡† */
    border: 3px solid white;
    border-radius: 50px; /* åœ“æ½¤çš„è† å›Šå½¢ç‹€ */
    
    /* æ–‡å­—è¨­å®š */
    color: white;
    font-family: 'Nunito', sans-serif; /* ç”¨åœ“ä¸€é»çš„è‹±æ–‡å­—é«” */
    font-weight: 900;
    font-size: 1rem;
    padding: 6px 15px;
    
    /* ç«‹é«”é™°å½± */
    box-shadow: 
        inset 0 2px 5px rgba(255,255,255,0.4), /* é ‚éƒ¨é«˜å…‰ */
        0 5px 10px rgba(0,0,0,0.3); /* å¤–éƒ¨é™°å½± */
        
    /* æ–‡å­—é™°å½± (å¢åŠ åˆ»å°æ„Ÿ) */
    text-shadow: 1px 1px 0 #9F0E0E;
    
    /* å¾®å¾®æ—‹è½‰ï¼Œçœ‹èµ·ä¾†åƒéš¨æ‰‹è²¼ä¸Šå»çš„è²¼ç´™ */
    transform: rotate(5deg);
}
        /* === 3. é›²æœµæ¨™é¡Œ (ç¶­æŒåŸæ¨£) === */
        .cloud-header {
            position: absolute;
            top: -25px;
            left: 45%;
            transform: translateX(-50%);
            background: white;
            padding: 8px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 0 #ddd, 0 10px 10px rgba(0,0,0,0.1);
            z-index: 20;
            border: 4px solid #E1F5FE;
            min-width: 180px;
            text-align: center;
        }
        
        .header-text {
    color: var(--header-blue);
    
    /* ä¿®æ”¹é€™è£¡ï¼šæ”¹æˆ Bagel Fat One */
    font-family: "Bagel Fat One", system-ui;
    font-weight: 800; /* é€™å€‹å­—é«”æœ¬èº«å°±å¾ˆç²—ï¼Œè¨­ 400 å³å¯ */
    font-size: 1.5rem; /* å¦‚æœè¦ºå¾—å­—å¤ªèƒ–è®Šæ“ ï¼Œå¯ä»¥ç¨å¾®ç¸®å°ä¸€é» */
    font-style: normal; /* é€™å€‹å­—é«”ä¸å»ºè­°ç”¨æ–œé«”ï¼Œæ­£çš„æ¯”è¼ƒå¯æ„› */
    
    /* ç‚ºäº†è®“èƒ–èƒ–å­—é«”æ›´ç«‹é«”ï¼Œå¯ä»¥åŠ å¼·æé‚Šæ•ˆæœ */
    text-shadow: 
        2px 2px 0px white, 
        4px 4px 0px rgba(0,0,0,0.1);
}

        /* === 4. é‡é»ï¼šæ–°ç‰ˆå¤©æ°£æ§‹åœ–å€ (Weather Scene) === */
        /* === 4. é‡é»ï¼šæ–°ç‰ˆå¤©æ°£æ§‹åœ–å€ (Weather Scene) === */
.weather-scene {
    position: relative;
    width: 100%;
    /* 1. é«˜åº¦æ‹‰é«˜ï¼šç‚ºäº†å®¹ç´ä¸Šä¸‹å…©å±¤çµæ§‹ */
    height: 220px; 
    margin-bottom: 5px;
    /* ç§»é™¤ flex centerï¼Œæ”¹ç”¨ absolute è‡ªç”±å®šä½ */
}

/* å·¨å¤§çš„æº«åº¦ (æ”¹ç‚ºï¼šä¸Šæ–¹ç½®ä¸­åå³) */
.big-temp {
    position: absolute;
    /* 2. å®šä½åœ¨ä¸Šæ–¹ */
    top: 10px; 
    /* ç¨å¾®å¾€å³åä¸€é» (left: 60%)ï¼Œé€™æ¨£å·¦ä¸‹è§’æ‰æœ‰ç©ºé–“è®“åœ–ç¤ºè“‹ä¸Šå» */
    left: 58%; 
    transform: translateX(-50%);
    
    font-family: 'Nunito', sans-serif;
    font-size: 8.5rem; /* å­—é«”å†ç¨å¾®åŠ å¤§ */
    font-weight: 900;
    color: var(--temp-color);
    line-height: 1;
    
    /* 3. é—œéµå±¤ç´šï¼šz-index: 1 (åœ¨åº•å±¤/å¾Œé¢) */
    z-index: 1; 
    
    text-shadow: 
        4px 4px 0 rgba(0,0,0,0.1),
        -2px -2px 0 rgba(255,255,255,0.5);
}

/* å¤©æ°£åœ–ç¤º (æ”¹ç‚ºï¼šå·¦ä¸‹è§’æµ®å‹•) */
/* å¤©æ°£åœ–ç¤º (å·¦ä¸‹è§’æµ®å‹• - åœ–ç‰‡ç‰ˆ) */
.float-icon {
    position: absolute;
    bottom: 10px;
    left: 10px;
    
    /* ä¿®æ”¹é€™è£¡ï¼šè¨­å®šåœ–ç‰‡å…·é«”å¤§å°ï¼Œå–ä»£åŸæœ¬çš„ font-size */
    width: 130px; 
    height: 130px;
    
    z-index: 5; 
    
    /* ç¢ºä¿åœ–ç‰‡æœ¬èº«æœ‰æµ®å‹•å‹•ç•« */
    animation: float 3s ease-in-out infinite;
}

/* ç¢ºä¿åœ–ç‰‡åœ¨å®¹å™¨å…§æ»¿ç‰ˆé¡¯ç¤º */
.float-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    /* åœ–ç‰‡é™°å½±ç›´æ¥åŠ åœ¨ img ä¸Šæ•ˆæœæ¯”è¼ƒå¥½ */
    filter: drop-shadow(5px 10px 10px rgba(0,0,0,0.2));
}

/* å¤©æ°£èªªæ˜ (æ”¹ç‚ºï¼šå³ä¸‹è§’ä¸¦æ’) */
.weather-desc {
    position: absolute;
    /* 6. å®šä½åœ¨å³ä¸‹è§’ */
    bottom: 30px; 
    right: 30px;
    
    text-align: right;
    line-height: 1.2;
    z-index: 2;
}

        .desc-main {
            font-size: 1.4rem;
            font-weight: 900;
            color: #D81B60; 
            opacity: 0.9;
        }
        
        .desc-sub {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--desc-color);
        }

        /* === 5. é“å…·åœˆåœˆ === */
        .powerups-container {
            display: flex;
            justify-content: space-around;
            gap: 12px;
            width: 100%;
            margin-top: 10px;
        }

        .powerup-circle {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--circle-blue-1), var(--circle-blue-2));
            border: 3px solid white;
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.1s;
        }
        .powerup-circle:active { transform: scale(0.95); }

        /* 1. é ‚éƒ¨ç³–æœæ¨™ç±¤ */
        .powerup-label {
            position: absolute; 
            top: -14px; 
            left: 50%;
            transform: translateX(-50%); 
            z-index: 5; 

            background: linear-gradient(to bottom, #FF9BB3, #bc4277); 
            color: white;
            font-weight: 900;
            font-size: 0.7rem;
            text-transform: uppercase; 
            letter-spacing: 1px; 
            padding: 3px 12px; 
            border-radius: 20px; 
            border: 2px solid white; 
            box-shadow: 0 3px 6px rgba(0,0,0,0.3); 
            white-space: nowrap; 
            text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        }

        /* 2. åœ–ç‰‡ä½ç½®å¾®èª¿ */
        .powerup-img {
            width: 60%;  
            height: 60%;
            object-fit: contain; 
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); 
            margin-top: 12px; 
            margin-bottom: 0; 
            animation: bounce-icon 2s infinite; 
        }

        @keyframes bounce-icon {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .badge-pill {
            position: absolute;
            bottom: -6px;
            right: -6px;
            background: #FFF8E1;
            color: #D81B60;
            font-weight: 900;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 10px;
            border: 2px solid #D81B60;
            min-width: 25px;
            text-align: center;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        /* === 6. åº•éƒ¨é•·æ¢ (ä¿®æ”¹ç‚ºåŠé€æ˜) === */
        .win-streak-bar {
            width: 100%;
            max-width: 380px; 
            /* ä¿®æ”¹é€™è£¡ï¼šæ”¹æˆ RGBA åŠé€æ˜æ·±è—è‰² */
            background: rgba(0, 31, 77, 0.6); 
            /* åŠ ä¸Šæ¯›ç»ç’ƒæ•ˆæœï¼Œå¢åŠ è³ªæ„Ÿ */
            backdrop-filter: blur(5px);
            
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border: 3px solid #4FC3F7;
            position: relative;
        }

        /* æ¨™é¡Œæ——å¹Ÿ */
        .streak-title {
            position: absolute;
            top: -14px;
            left: 50%;
            transform: translateX(-50%);
            background: #1565C0;
            color: white;
            font-size: 0.8rem;
            font-weight: 900;
            padding: 4px 15px;
            border-radius: 10px;
            border: 2px solid white;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
        }

        .hourly-scroll {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding-top: 5px;
            scrollbar-width: none;
        }
        .hourly-scroll::-webkit-scrollbar { display: none; }

        .hour-item {
            min-width: 65px;
            background: linear-gradient(135deg, #7B1FA2, #4A148C);
            border-radius: 15px;
            padding: 8px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            flex-shrink: 0;
        }
        
        .hour-time { font-size: 0.7rem; opacity: 0.8; margin-bottom: 2px; font-weight: 700;}
        /* === ä¿®æ­£ä¸‹æ–¹é å ±å¡ç‰‡åœ–ç¤ºéå¤§çš„å•é¡Œ === */

.hour-icon {
    /* è®“åœ–ç‰‡å®¹å™¨ç½®ä¸­ */
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 5px 0;
}

/* é—œéµï¼šå¼·åˆ¶é™åˆ¶ä¸‹æ–¹å¡ç‰‡è£¡çš„åœ–ç‰‡å¤§å° */
.hour-icon img {
    width: 40px;  /* è¨­å®šå¯¬åº¦ï¼ŒåŸæœ¬æ˜¯ 240px å¤ªå¤§äº† */
    height: 40px; /* è¨­å®šé«˜åº¦ */
    object-fit: contain; /* ä¿æŒæ¯”ä¾‹ */
    filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2)); /* åŠ ä¸€é»å°é™°å½± */
}
        .hour-temp { font-size: 1rem; font-weight: 900; }

        /* å‹•ç•« */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Loading */
        .loading-mask {
            position: fixed; inset: 0; background: #001F4D; z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
        }
    </style>
</head>
<body>

    <div id="loading" class="loading-mask">
        <div style="font-size: 4rem; animation: float 1s infinite;">ğŸ¬</div>
        <h3 style="margin-top: 10px;">Loading Sweetness...</h3>
    </div>

    <div class="candy-card-wrapper">
        <div id="dateBadge" class="date-badge">Loading...</div>
        <div class="cloud-header">
            <div class="header-text" id="locationTitle">Level 1</div>
        </div>

        <div class="candy-inner">
            
            <div class="weather-scene">
                <div class="float-icon" id="mainIcon">â˜€ï¸</div>
                <div class="big-temp" id="mainTemp">--Â°</div>
                <div class="weather-desc">
                    <div class="desc-main" id="weatherTitle">Clear</div>
                    <div class="desc-sub" id="weatherSub">é™é›¨ 0%</div>
                </div>
            </div>

            <div class="powerups-container">
                <div class="powerup-circle">
                    <img src="https://img.icons8.com/fluency/96/umbrella.png" class="powerup-img" alt="é›¨å‚˜">
                    <div class="powerup-label">Rain</div>
                    <div class="badge-pill" id="rainVal">--</div>
                </div>

                <div class="powerup-circle">
                    <img src="https://img.icons8.com/fluency/96/water.png" class="powerup-img" alt="æ¿•åº¦">
                    <div class="powerup-label">Humid</div>
                    <div class="badge-pill" id="humidVal">--</div>
                </div>

                <div class="powerup-circle">
                    <img src="https://img.icons8.com/fluency/96/wind.png" class="powerup-img" alt="é¢¨é€Ÿ">
                    <div class="powerup-label">Wind</div>
                    <div class="badge-pill" id="windVal">2</div>
                </div>
            </div>
        </div>
    </div>

    <div class="win-streak-bar">
        <div class="streak-title">Future Forecast</div>
        <div class="hourly-scroll" id="hourlyStrip">
            </div>
    </div>

    <script>
        const API_URL = "https://weatherkeelung.zeabur.app/api/weather/kaohsiung";

        function getWeatherIcon(weather) {
    let iconUrl = "https://img.icons8.com/fluency/240/partly-cloudy-day.png"; // é è¨­åœ– (å¤šé›²)

    // ç°¡å–®çš„é—œéµå­—åˆ¤æ–·ï¼Œä½ å¯ä»¥æ ¹æ“šéœ€è¦æ“´å……
    if (weather.includes("æ™´")) {
        iconUrl = "https://img.icons8.com/fluency/240/sun.png";
    } else if (weather.includes("é›·")) {
        iconUrl = "https://img.icons8.com/fluency/240/storm.png";
    } else if (weather.includes("é›¨")) {
        iconUrl = "https://img.icons8.com/fluency/240/moderate-rain.png";
    } else if (weather.includes("é™°") || weather.includes("é›²")) {
        iconUrl = "https://img.icons8.com/fluency/240/clouds.png";
    } else if (weather.includes("å¤šé›²")) {
        iconUrl = "https://img.icons8.com/fluency/240/partly-cloudy-day.png";
    }

    // å›å‚³åœ–ç‰‡æ¨™ç±¤
    return `<img src="${iconUrl}" alt="${weather}">`;
}

        function formatTime(isoString) {
            const date = new Date(isoString);
            return `${date.getHours()}:00`; 
        }

        function renderWeather(data) {
            const forecasts = data.forecasts;
            const current = forecasts[0];
            const others = forecasts.slice(1);

            // === ä¿®æ”¹é€™è£¡ ===
            // 1. åœ°é»æ”¹æˆ "åŸºéš† City"
            document.getElementById('locationTitle').innerText = "KEELUNG"; 

            // 2. ä¸»ç•«é¢æ•¸æ“š
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);
            
            document.getElementById('mainTemp').innerText = `${avgTemp}Â°`;
            document.getElementById('mainIcon').innerHTML = getWeatherIcon(current.weather);
            document.getElementById('weatherTitle').innerText = current.weather;
            document.getElementById('weatherSub').innerText = `é™é›¨ ${current.rain}`;

            // 3. é“å…·æ•¸æ“š
            document.getElementById('rainVal').innerText = current.rain; 
            document.getElementById('humidVal').innerText = "60"; 
            document.getElementById('windVal').innerText = "Lv2"; 

            // 4. ä¸‹æ–¹é å ±æ¢
            const strip = document.getElementById('hourlyStrip');
            strip.innerHTML = ''; 

            others.forEach(f => {
                const timeStr = formatTime(f.startTime);
                const t = Math.round((parseInt(f.maxTemp) + parseInt(f.minTemp)) / 2);
                
                strip.innerHTML += `
                    <div class="hour-item">
                        <div class="hour-time">${timeStr}</div>
                        <div class="hour-icon">${getWeatherIcon(f.weather)}</div>
                        <div class="hour-temp">${t}Â°</div>
                    </div>
                `;
            });
            // === æ–°å¢ï¼šè¨­å®šæ—¥æœŸ ===
    const now = new Date();
    const yyyy = now.getFullYear();
    // æœˆä»½è·Ÿæ—¥æœŸå¦‚æœä¸æ»¿ 10ï¼Œå‰é¢è£œ 0 (ä¾‹å¦‚ 5 -> 05)
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    
    document.getElementById('dateBadge').innerText = `${yyyy}/${mm}/${dd}`;

        }

        async function fetchWeather() {
            try {
                await new Promise(r => setTimeout(r, 1000)); 
                const res = await fetch(API_URL);
                const json = await res.json();

                if (json.success) {
                    renderWeather(json.data);
                    document.getElementById('loading').style.display = 'none';
                } else {
                    alert("API Error");
                }
            } catch (e) {
                console.error(e);
                alert("è®€å–å¤±æ•—");
            }
        }

        document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
</body>
</html>